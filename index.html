<html>
<script src=
'https://d3js.org/d3.v5.min.js'></script>

<body>
    <script>
        <html>
            <script src='https://d3js.org/d3.v5.min.js'></script>
    <body onload='init()'>
        <h1 style="position: absolute; left:200px; white-space: nowrap;"> Test Scores After Experimental Or Non-Experimental Instruction </h1> 
        <p style="position: absolute; left:300px; top: 80px;">This dataset is based on the pretest and posttest results of students when evaluated on a certain subject before and after they learn a subject. 
            The teaching was done in either an experimental (students were given experiments to run that related to the lesson) or standard (non-experimental) 
            understanding of the class, and they were evaluated from there. The bar graph on the right of the figure is interactable and will filter both the 
            results for the scatterplot and the bar graphs.</p>
        <svg width=500 height=700 >
        </svg>
        <script>
                async function init() {
                    const data = await d3.csv('https://narquie.github.io/test_scores.csv');
                    // Boolean for visibility on circles
                    function invisCirc(d,parameters) {
                        var standard = true;
                        if (parameters[1]){
                            standard = (d.teaching_method === "Standard")
                        }
                        var experimental = true;
                        if (parameters[0]){
                            experimental = (d.teaching_method === "Experimental")
                        }
                        var qualify = true;
                        if (parameters[2]){
                            qualify = (d.lunch === "Qualifies for reduced/free lunch")
                        }
                        var notqualify = true;
                        if (parameters[3]){
                            notqualify = (d.lunch === "Does not qualify")
                        }
                        var rural = true;
                        if (parameters[4]){
                            rural = (d.school_setting === "Rural")
                        }
                        var urban = true;
                        if (parameters[5]){
                            urban = (d.school_setting === "Urban")
                        }
                        var suburban = true;
                        if (parameters[6]){
                            suburban = (d.school_setting === "Suburban")
                        }
                        var private = true;
                        if (parameters[7]){
                            private = (d.school_type === "Non-public")
                        }
                        var public = true;
                        if (parameters[8]){
                            public = (d.school_type === "Public")
                        }
                        return(experimental && standard && qualify && notqualify && rural && urban && suburban && private && public)
                    }
                    // Filtering function
                    function meanCondition(data, parameters) {
                        return d3.mean(data.filter(function(d) {
                            var standard = true;
                            if (parameters[1]){
                                standard = (d.teaching_method === "Standard")
                            }
                            var experimental = true;
                            if (parameters[0]){
                                experimental = (d.teaching_method === "Experimental")
                            }
                            var qualify = true;
                            if (parameters[2]){
                                qualify = (d.lunch === "Qualifies for reduced/free lunch")
                            }
                            var notqualify = true;
                            if (parameters[3]){
                                notqualify = (d.lunch === "Does not qualify")
                            }
                            var rural = true;
                            if (parameters[4]){
                                rural = (d.school_setting === "Rural")
                            }
                            var urban = true;
                            if (parameters[5]){
                                urban = (d.school_setting === "Urban")
                            }
                            var suburban = true;
                            if (parameters[6]){
                                suburban = (d.school_setting === "Suburban")
                            }
                            var private = true;
                            if (parameters[7]){
                                private = (d.school_type === "Non-public")
                            }
                            var public = true;
                            if (parameters[8]){
                                public = (d.school_type === "Public")
                            }
                            return(experimental && standard && qualify && notqualify && rural && urban && suburban && private && public)
                        }), d => d.posttest);   // The function returns the product of p1 and p2
                    }
                        function redraw(){
                            d3.select("svg").selectAll("g").selectAll("rect")
                            .attr('y',function(d,i) {
                                console.log(d)
                                switch(d) {
                                case 0:
                                    return ysbar(meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,true,filterurban,filtersuburban,filterprivate,filterpublic]))
                                    break;
                                case 1:
                                    return ysbar(meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,filterrural,true,filtersuburban,filterprivate,filterpublic]))
                                    break;
                                case 2:
                                    return ysbar(meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,filterrural,filterurban,true,filterprivate,filterpublic]))
                                    break;
                                case 3:
                                    return ysbar(meanCondition(data,[filterexperimental,true,filterqualify,filternotqualify,filterrural,filterurban,filtersuburban,filterprivate,filterpublic]))
                                    break;  
                                case 4:
                                    return ysbar(meanCondition(data,[true,filterstandard,filterqualify,filternotqualify,filterrural,filterurban,filtersuburban,filterprivate,filterpublic]))
                                    break;
                                case 5:
                                    return ysbar(meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,filterrural,filterurban,filtersuburban,filterprivate,true])) + 200
                                    break;
                                case 6:
                                    return ysbar(meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,filterrural,filterurban,filtersuburban,true,filterpublic])) + 200
                                    break;
                                case 7:
                                    return ysbar(meanCondition(data,[filterexperimental,filterstandard,true,filternotqualify,filterrural,filterurban,filtersuburban,filterprivate,filterpublic])) + 200
                                    break;
                                case 8:
                                    return ysbar(meanCondition(data,[filterexperimental,filterstandard,filterqualify,true,filterrural,filterurban,filtersuburban,filterprivate,filterpublic])) + 200
                                    break;
                            };})
                            .attr('height',function(d,i) {
                                switch(d) {
                                case 0:
                                    return xsbar(meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,true,filterurban,filtersuburban,filterprivate,filterpublic]))
                                    break;
                                case 1:
                                    return xsbar(meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,filterrural,true,filtersuburban,filterprivate,filterpublic]))
                                    break;
                                case 2:
                                    return xsbar(meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,filterrural,filterurban,true,filterprivate,filterpublic]))
                                    break;
                                case 3:
                                    return xsbar(meanCondition(data,[filterexperimental,true,filterqualify,filternotqualify,filterrural,filterurban,filtersuburban,filterprivate,filterpublic]))
                                    break;
                                case 4:
                                    return xsbar(meanCondition(data,[true,filterstandard,filterqualify,filternotqualify,filterrural,filterurban,filtersuburban,filterprivate,filterpublic]))
                                    break;
                                case 5:
                                    return xsbar(meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,filterrural,filterurban,filtersuburban,filterprivate,true]))
                                    break;
                                case 6:
                                    return xsbar(meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,filterrural,filterurban,filtersuburban,true,filterpublic]))
                                    break;
                                case 7:
                                    return xsbar(meanCondition(data,[filterexperimental,filterstandard,true,filternotqualify,filterrural,filterurban,filtersuburban,filterprivate,filterpublic]))
                                    break;
                                case 8:
                                    return xsbar(meanCondition(data,[filterexperimental,filterstandard,filterqualify,true,filterrural,filterurban,filtersuburban,filterprivate,filterpublic]))
                                    break;
                            };});
                            d3.select("svg").selectAll("g").selectAll("circle").attr("visibility",function(d,i){
                                if(invisCirc(d,[filterexperimental,filterstandard,filterqualify,filternotqualify,filterrural,filterurban,filtersuburban,filterprivate,filterpublic])){
                                    return "visible"
                                } else {
                                    return "hidden"
                                }
                            })
                        }
                        // Main Scatterplot
                        margin = 200
                        height = 1000
                        width = 1000
                        xdomain = [0,100];
                        xrange = [0,500];
                        ydomain = [0,100];
                        yrange = [500,0];
                        xs = d3.scaleLinear().domain(xdomain).range(xrange);
                        ys = d3.scaleLinear().domain(ydomain).range(yrange);
                        d3.select('svg')
                        .attr("width",width + margin)
                        .attr("height",height + margin)
                        .append("g")
                        .attr("transform","translate("+margin+","+margin+")")
                        .selectAll('circle')
                        .data(data)
                        .enter()
                        .append("circle")
                        .attr('cx',function(d,i) {return xs(d.pretest);})
                        .attr('cy',function(d,i) {return ys(d.posttest);})
                        .attr("r",5)
                        .attr("fill",function(d,i){ if(d.gender=="Female"){return "#DB25C3"}else{return "#256FDB"}})
                        .on("mouseover", function(d,i) {
                                    d3.select(this).attr('stroke', "black").append("title").text(function(d,i){return "Sex: " + d.gender + ", Pretest: " + d.pretest + ", Posttest " + d.posttest});
                                })
                            .on("mouseout", function() {
                                d3.select(this).attr('stroke',"none");
                                d3.select(this).select("title").remove();
                            })
                        d3.select("svg")
                        .append("g")
                        .attr("transform","translate("+margin+","+(height/2+margin)+")")
                        .call(d3.axisBottom(xs));
                        d3.select("svg")
                        .append("text").attr("transform","translate("+(width/4 + margin)+","+(height/2+margin+50)+")")
                        .style("text-anchor", "middle")
                        .text("Pretest Score");
                        d3.select("svg")
                        .append("g")
                        .attr("transform","translate("+margin+","+margin+")")
                        .call(d3.axisLeft(ys));
                        d3.select("svg")
                        .append("text")
                        .attr("transform","rotate(-90)")
                        .attr("y",margin-50)
                        .attr("x",-(height/4 + margin))
                        .style("text-anchor", "middle")
                        .text("Posttest Score");

                        // Filters
                        var filterrural = false;
                        var filterurban = false;
                        var filtersuburban = false;
                        var filterstandard = false;
                        var filterexperimental = false;
                        var filterpublic = false;
                        var filterprivate = false;
                        var filterqualify = false;
                        var filternotqualify = false;
                        
                        // Bar Chart School Region
                        xbarrange = [0,200]
                        ybarrange = [200,0]
                        xsbar = d3.scaleLinear().domain(xdomain).range(xbarrange);
                        ysbar = d3.scaleLinear().domain(ydomain).range(ybarrange);
                        rural = meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,true,filterurban,filtersuburban,filterprivate,filterpublic])
                        urban = meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,filterrural,true,filtersuburban,filterprivate,filterpublic])
                        suburban = meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,filterrural,filterurban,true,filterprivate,filterpublic])
                        d3.select('svg')
                        .attr("width",width + margin)
                        .attr("height",height + margin)
                        .append("g")
                        .attr("transform","translate("+margin+","+margin+")")
                        .selectAll('rect')
                        .data([0,1,2])
                        .enter()
                        .append('rect')
                            .attr('x',function(d,i){return margin * 2 + 150 + i*40;})
                            .attr('y',function(d,i) {if(d==0){return ysbar(rural)}else{if(d==1){return ysbar(urban)}else{return ysbar(suburban)}};})
                            .attr('width',30)
                            .attr('height',function(d,i) {if(d==0){return xsbar(rural)}else{if(d==1){return xsbar(urban)}else{return xsbar(suburban)}};})
                            .on("mouseover", function() {
                                    d3.select(this).attr('stroke', "black");
                                })
                            .on("mouseout", function() {
                                d3.select(this).attr('stroke',"none");
                            })
                            .on("click",function(d,i){
                                if((d == 0 && filterurban && filtersuburban) || (d == 1 && filterrural && filtersuburban) || (d == 1 && filterrural && filterurban)){
                                    d3.select(this).transition().duration(2000).attr("stroke","red").attr("stroke-width",5).transition().duration(100).attr("stroke","none").attr("stroke-width",1)
                                }
                                else {
                                    if(d == 0 && !filterrural){
                                        filterrural = true;
                                    } else {
                                        if(d == 0 && filterrural){
                                            filterrural = false;
                                        }
                                    }
                                    if(d == 1 && !filterurban){
                                        filterurban = true;
                                    } else {
                                        if(d == 1 && filterurban){
                                            filterurban = false;
                                        }
                                    }
                                    if(d == 2 && !filtersuburban){
                                        filtersuburban = true;
                                    } else {
                                        if(d == 2 && filtersuburban){
                                            filtersuburban = false;
                                        }
                                    }
                                    redraw()
                                }
                            })
                            .style('fill',function(d,i) {if(d==0){return "#32CD32"}else{if(d==1){return "#FF7F7F"}else{return "#aacbe9"}};});
                        d3.select("svg")
                        .append("g")
                        .attr("transform","translate("+750+","+margin+")")
                        .call(d3.axisLeft(ysbar));
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin * (-1) - 60)
                        .attr("y",margin*3 + 110)
                        .style("text-anchor", "end")  
                        .text("Avg. Posttest Score")
                        .attr("transform","rotate(-90)");
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin*(-2))
                        .attr("y",margin*3 + 170)
                        .style("text-anchor", "end")  
                        .text("Rural")
                        .attr("transform","rotate(-90)");
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin*(-2))
                        .attr("y",margin * 4 + 10)
                        .style("text-anchor", "end")
                        .text("Urban")
                        .attr("transform","rotate(-90)");
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin*(-2))
                        .attr("y",margin * 4 + 50)
                        .style("text-anchor", "end")
                        .text("Suburban")
                        .attr("transform","rotate(-90)");
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin*3 + 170)
                        .attr("y",margin)
                        .style("text-anchor", "start")  
                        .text("School Region")
                        
                        // Teaching type
                        standard = meanCondition(data,[filterexperimental,true,filterqualify,filternotqualify,filterrural,filterurban,filtersuburban,filterprivate,filterpublic])
                        experimental = meanCondition(data,[true,filterstandard,filterqualify,filternotqualify,filterrural,filterurban,filtersuburban,filterprivate,filterpublic])
                        d3.select('svg')
                        .attr("width",width + margin)
                        .attr("height",height + margin)
                        .append("g")
                        .attr("transform","translate("+margin+","+margin+")")
                        .selectAll('rect')
                        .data([3,4])
                        .enter()
                        .append('rect')
                            .attr('x',function(d,i){return margin * 3 + 185 + i*40;})
                            .attr('y',function(d,i) {if(d==3){return ysbar(standard)}else{return ysbar(experimental)};})
                            .attr('width',30)
                            .attr('height',function(d,i) {if(d==3){return xsbar(standard)}else{return xsbar(experimental)};})
                            .on("mouseover", function() {
                                    d3.select(this).attr('stroke', "black");
                                })
                            .on("mouseout", function() {
                                d3.select(this).attr('stroke',"none");
                            })
                            .on("click",function(d,i){
                                if((d == 3 && filterexperimental) || (d == 4 && filterstandard)){
                                    d3.select(this).transition().duration(2000).attr("stroke","red").attr("stroke-width",5).transition().duration(100).attr("stroke","none").attr("stroke-width",1)
                                }
                                else {
                                    if(d == 3 && !filterstandard){
                                        filterstandard = true;
                                    } else {
                                        if(d == 3 && filterstandard){
                                            filterstandard = false;
                                        }
                                    }
                                    if(d == 4 && !filterexperimental){
                                        filterexperimental = true;
                                    } else {
                                        if(d == 4 && filterexperimental){
                                            filterexperimental = false;
                                        }
                                    }
                                    redraw()
                                }
                            })
                            .style('fill',function(d,i) {if(d==3){return "#E4D00A"}else{return "#CBC3E3"};});
                        d3.select("svg")
                        .append("g")
                        .attr("transform","translate("+985+","+margin+")")
                        .call(d3.axisLeft(ysbar));
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin * (-1) - 60)
                        .attr("y",margin*4 + 140)
                        .style("text-anchor", "end")  
                        .text("Avg. Posttest Score")
                        .attr("transform","rotate(-90)");
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin * (-2))
                        .attr("y",margin * 5 + 5)
                        .style("text-anchor", "end")  
                        .text("Standard")
                        .attr("transform","rotate(-90)");
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin * (-2))
                        .attr("y",margin * 5 + 45)
                        .style("text-anchor", "end")
                        .text("Experimental")
                        .attr("transform","rotate(-90)");
                        d3.select("svg")
                        .append("text")
                        .attr("x",5*margin+5)
                        .attr("y",margin)
                        .style("text-anchor", "start")  
                        .text("Teaching Method")
                        
                        // Public vs Private
                        public = meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,filterrural,filterurban,filtersuburban,filterprivate,true])
                        private = meanCondition(data,[filterexperimental,filterstandard,filterqualify,filternotqualify,filterrural,filterurban,filtersuburban,true,filterpublic])
                        d3.select('svg')
                        .attr("width",width + margin)
                        .attr("height",height + margin)
                        .append("g")
                        .attr("transform","translate("+margin+","+margin*1.50+")")
                        .selectAll('rect')
                        .data([5,6])
                        .enter()
                        .append('rect')
                            .attr('x',function(d,i){return margin*2+150 + i*40;})
                            .attr('y',function(d,i) {if(d==5){return ysbar(public)+200}else{return ysbar(private)+margin};})
                            .attr('width',30)
                            .attr('height',function(d,i) {if(d==5){return xsbar(public)}else{return xsbar(private)};})
                            .on("mouseover", function() {
                                    d3.select(this).attr('stroke', "black");
                                })
                            .on("mouseout", function() {
                                d3.select(this).attr('stroke',"none");
                            })
                            .on("click",function(d,i){
                                if((d == 5 && filterprivate) || (d == 6 && filterpublic)){
                                    d3.select(this).transition().duration(2000).attr("stroke","red").attr("stroke-width",5).transition().duration(100).attr("stroke","none").attr("stroke-width",1)
                                }
                                else {
                                    if(d == 5 && !filterpublic){
                                        filterpublic = true;
                                    } else {
                                        if(d == 5 && filterpublic){
                                            filterpublic = false;
                                        }
                                    }
                                    if(d == 6 && !filterprivate){
                                        filterprivate = true;
                                    } else {
                                        if(d == 6 && filterprivate){
                                            filterprivate = false;
                                        }
                                    }
                                    redraw()
                                }
                            })
                            .style('fill',function(d,i) {if(d==5){return "#aacbe9"}else{return "#d3d3d3"};});
                        d3.select("svg")
                        .append("g")
                        .attr("transform","translate("+750+","+500+")")
                        .call(d3.axisLeft(ysbar));
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin * (-2) - 150)
                        .attr("y",margin*3 + 110)
                        .style("text-anchor", "end")  
                        .text("Avg. Posttest Score")
                        .attr("transform","rotate(-90)");
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin * (-3) - 100)
                        .attr("y",margin * 3 + 170)
                        .style("text-anchor", "end")  
                        .text("Public")
                        .attr("transform","rotate(-90)");
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin*(-3)-100)
                        .attr("y",margin * 4 + 10)
                        .style("text-anchor", "end")
                        .text("Non-public")
                        .attr("transform","rotate(-90)");
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin * 3 + 170)
                        .attr("y",margin*2 + 100)
                        .style("text-anchor", "start")  
                        .text("Type of School")
                        

                        // Qualifies for free lunch
                        qualify = meanCondition(data,[filterexperimental,filterstandard,true,filternotqualify,filterrural,filterurban,filtersuburban,filterprivate,filterpublic])
                        notqualify = meanCondition(data,[filterexperimental,filterstandard,filterqualify,true,filterrural,filterurban,filtersuburban,filterprivate,filterpublic])
                        d3.select('svg')
                        .attr("width",width + margin)
                        .attr("height",height + margin)
                        .append("g")
                        .attr("transform","translate("+margin+","+margin*1.5+")")
                        .selectAll('rect')
                        .data([7,8])
                        .enter()
                        .append('rect')
                            .attr('x',function(d,i){return margin*3+185 + i*40;})
                            .attr('y',function(d,i) {if(d==7){return ysbar(qualify)+margin}else{return ysbar(notqualify)+margin};})
                            .attr('width',30)
                            .attr('height',function(d,i) {if(d==7){return xsbar(qualify)}else{return xsbar(notqualify)};})
                            .on("mouseover", function() {
                                    d3.select(this).attr('stroke', "black");
                                })
                            .on("mouseout", function() {
                                d3.select(this).attr('stroke',"none");
                            })
                            .on("click",function(d,i){
                                console.log("click")
                                if((d == 7 && filternotqualify) || (d == 8 && filterqualify)){
                                    d3.select(this).transition().duration(2000).attr("stroke","red").attr("stroke-width",5).transition().duration(100).attr("stroke","none").attr("stroke-width",1)
                                }
                                else {
                                    if(d == 7 && !filterqualify){
                                        filterqualify = true;
                                    } else {
                                        if(d == 7 && filterqualify){
                                            filterqualify = false;
                                        }
                                    }
                                    if(d == 8 && !filternotqualify){
                                        filternotqualify = true;
                                    } else {
                                        if(d == 8 && filternotqualify){
                                            filternotqualify = false;
                                        }
                                    }
                                    redraw();
                                }
                            })
                            .style('fill',function(d,i) {if(d==7){return "#32CD32"}else{return "#FF7F7F"};});
                        d3.select("svg")
                        .append("g")
                        .attr("transform","translate("+985+","+500+")")
                        .call(d3.axisLeft(ysbar));
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin * (-2) - 150)
                        .attr("y",margin*4 + 140)
                        .style("text-anchor", "end")  
                        .text("Avg. Posttest Score")
                        .attr("transform","rotate(-90)");
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin * (-3) - 100)
                        .attr("y",margin*5 + 5)
                        .style("text-anchor", "end")  
                        .text("Qualifies for reduced/free lunch")
                        .attr("transform","rotate(-90)");
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin * -3 - 100)
                        .attr("y",margin*5 +45)
                        .style("text-anchor", "end")
                        .text("Does not qualify")
                        .attr("transform","rotate(-90)");
                        d3.select("svg")
                        .append("text")
                        .attr("x",margin*5 + 5)
                        .attr("y",margin*2 + 100)
                        .style("text-anchor", "start")  
                        .text("Reduced/free lunch")
                }
        </script>
    </body>

</html>